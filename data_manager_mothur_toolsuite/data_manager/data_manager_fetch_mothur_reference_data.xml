<tool id="data_manager_fetch_mothur_reference_data" name="Fetch Mothur toolsuite reference data" version="0.1.0" tool_type="manage_data">
    <description>Fetch and install reference data for Mothur</description>
    <command interpreter="python">fetch_mothur_reference_data.py
    --source=$data_source.data_source_selector
    #if str( $data_source.data_source_selector ) == "mothur_website"
       --datasets "${data_source.ref_data}"
    #elif str( $data_source.data_source_selector ) == "file"
       --description "${data_source.description}"
       --file "${data_source.filename}"
       #if $data_source.create_symlink
         --link
       #end if
    #end if
    "${out_file}"
    </command>
    <inputs>
      <conditional name="data_source">
	<param name="data_source_selector" type="select"
	       label="Choose the source for the reference data">
	  <option value="mothur_website">Mothur website</option>
	  <option value="file">File on local server</option>
	</param>
	<when value="mothur_website">
	  <param name="ref_data" type="select" display="checkboxes" multiple="true"
		 label="Reference dataset to install">
	    <option value="lookup_titanium">GS FLX Titanium lookup files</option>
	    <option value="lookup_gsflx">GSFLX lookup files</option>
	    <option value="lookup_gs20">GS20 lookup files</option>
	    <option value="RDP_v9">RDP reference files (training set version 9)</option>
	    <option value="RDP_v7">RDP reference files (training set version 7)</option>
	    <option value="RDP_v6">RDP reference files (training set version 6)</option>
	    <option value="silva_release_119">SILVA reference files (release 119)</option>
	    <option value="silva_release_102">SILVA reference files (release 102)</option>
	    <option value="greengenes_August2013">Greengenes reference taxonomy and alignment (August 2013)</option>
	    <option value="greengenes_May2013">Greengenes reference taxonomy and alignment (May 2013)</option>
	    <option value="greengenes_old">Greengenes reference taxonomy and alignment (pre-May 2013)</option>
	    <option value="greengenes_gold_alignment">Greengenes gold alignment</option>
	    <option value="secondary_structure_maps_silva">SILVA secondary structure maps</option>
	    <option value="secondary_structure_maps_greengenes">Greengenes secondary structure maps</option>
	  </param>
	</when>
	<when value="file">
	  <param name="description" type="text" value="" size="50"
		 label="Description of the data" optional="False" />
	  <param name="filename" type="text" value="" size="50"
		 label="Full path to reference data file on disk" optional="False" />
          <param type="boolean" name="create_symlink" truevalue="create_symlink"
		 falsevalue="copy_file"
		 label="Create symlink to orignal data instead of copying" checked="on" />
	</when>
      </conditional>
    </inputs>
    <outputs>
      <data name="out_file" format="data_manager_json" />
    </outputs>
    <tests>
      <test>
	<param name="data_sourece|ref_data" value="lookup_titanium"/>
	<output name="out_file">
	  <assert_contents>
	    <has_text text="GS FLX Titanium" />
	    <has_text text="LookUp_Titanium.pat" />
	  </assert_contents>
	</output>
      </test>
    </tests>
    <help>

This tool downloads and installs reference data used by the mothur_toolsuite
set of Galaxy tools.

Reference data URLS found via:

 * Lookup data:        http://www.mothur.org/wiki/Lookup_files
 * RDP reference data: http://www.mothur.org/wiki/RDP_reference_files
 * Silva data:         http://www.mothur.org/wiki/Silva_reference_files
 * Greengenes data:    http://www.mothur.org/wiki/Greengenes-formatted_databases
 * Secondary structure maps: http://www.mothur.org/wiki/Secondary_structure_map

Lane mask information (not currently used): http://www.mothur.org/wiki/Lane_mask

    </help>
</tool>

